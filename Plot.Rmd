---
title: "NYC Restaurant Inspections"
output: 
  html_document:
    toc: true
    toc_float: true
---

#### Load packages and data

```{r library, message =  FALSE}
library(tidyverse)
library(p8105.datasets)
library(plotly)

data("rest_inspec")
```

The original dataset is too big, so I am restricting my dataset to inspection that was conducted in 2017 and exclude those observations that don't belong to any borough.
```{r restrict dataset, message = FALSE}
nyc_inspection = 
  rest_inspec %>% 
  janitor::clean_names() %>% 
  filter(inspection_date >= '2017-01-01',
         boro != "Missing") %>% 
  rename(borough = boro) %>% 
  mutate(borough = str_to_title(borough))
```

Three questions I can answer using this dataset:

1. In each borough, how many restaurants were inspected in 2017?
```{r Q1 bar graph}
rest_insp = tibble(
  nyc_inspection %>%
  group_by(borough) %>% 
  summarize(n_restaurant = n())) 
 
rest_insp %>% 
  mutate(borough = fct_reorder(borough, n_restaurant)) %>% 
  plot_ly(
    x = ~borough, y = ~n_restaurant, color = ~borough,
    type = "bar") %>% 
  layout(title = 'Number of restaurants inspected in 2017', 
         plot_bgcolor = "#e5ecf6", 
         xaxis = list(title = 'Borough'), 
         yaxis = list(title = 'Number of restaurant'), 
         legend = list(title = list(text = 'Borough')))
```


2. Among the inspected restaurant in each borough, what proportion of them received grade A for their inspections?
```{r Q2 pie chart}
grade_A = tibble(
  nyc_inspection %>%
  filter(grade == "A") %>% 
  group_by(borough) %>% 
  summarize(n_A_rest = n()))
  
nyc_grade_A = 
  full_join(rest_insp, grade_A, by = "borough") %>% 
  mutate(
    percent_A = (n_A_rest / n_restaurant) * 100,
    percent_A = round(percent_A, digits = 2))

nyc_grade_A %>% 
  plot_ly(
    labels = ~borough,
    values = ~percent_A,
    type = 'pie',
    text = 'percent_A',
    textposition = "inside",
    textinfo = "value") %>%
  layout(
    title = "Proportion of grade A restaurants in each borough (%)",
    textinfo = 'values',
    xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
    yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
    legend = list(title = list(text = 'Borough')))
```


3. What are the top 10 most common violation codes among the inspected restaurants in 2017?
```{r most common violation code}
nyc_inspection %>% 
  count(violation_code) %>% 
  arrange(desc(n)) %>% 
  slice(1:10) %>% 
  knitr::kable()
```

